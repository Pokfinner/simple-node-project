# # .github/workflows/cd.yml
# name: CD
# run-name: CD Cool

# on:
#   workflow_run:
#     workflows:
#       - Nodejs_CI
#     types:
#       - completed

# jobs:
#   build-and-deploy:
#     if: ${{ github.event.workflow_run.conclusion == 'success' && github.event.workflow_run.head_branch == 'main' }}
#     runs-on: ubuntu-latest

#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v4

#       - name: Configure AWS credentials
#         uses: aws-actions/configure-aws-credentials@v2
#         with:
#           role-to-assume: arn:aws:iam::your-account-id:role/your-role-name
#           aws-region: ${{ secrets.AWS_REGION }}
#           role-session-name: GitHubActions

#       - name: Log in to Amazon ECR
#         id: login-ecr
#         uses: aws-actions/amazon-ecr-login@v1

#       - name: Build, tag, and push image to Amazon ECR
#         env:
#           ECR_REGISTRY: ${{ steps.login-ecr.outputs.registry }}
#           ECR_REPOSITORY: simple-node-project
#           IMAGE_TAG: ${{ github.event.workflow_run.head_sha }}
#         run: |
#           docker build -t $ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG .
#           docker push $ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG

#       - name: Set up kubectl
#         run: |
#           echo "${{ secrets.KUBE_CONFIG_DATA }}" | base64 --decode > kubeconfig
#           export KUBECONFIG=$PWD/kubeconfig

#       - name: Update Kubernetes deployment image
#         run: |
#           kubectl set image deployment/simple-node-deployment simple-node-container=$ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG
